--- a/src/nova/agent/state.py
+++ b/src/nova/agent/state.py
@@ -4,7 +4,7 @@ Agent state management for Nova CI-Rescue.
 
 from dataclasses import dataclass, field
 from typing import List, Optional, Dict, Any
 from datetime import datetime
 from pathlib import Path
 
 
@@ -31,6 +31,11 @@ class AgentState:
     current_iteration: int = 0
     max_iterations: int = 6
     timeout_seconds: int = 1200
     start_time: datetime = field(default_factory=datetime.now)
     current_step: int = 0  # Track step number for commits
     
+    # Loop prevention
+    used_actions: set = field(default_factory=set)  # Track (tool_name, args, modification_count)
+    modifications_count: int = 0  # Increment when files are modified
+    file_cache: Dict[str, str] = field(default_factory=dict)  # Cache file contents
+    
     # Results
     patches_applied: List[str] = field(default_factory=list)
     test_results: List[Dict[str, Any]] = field(default_factory=list)
@@ -72,6 +77,11 @@ class AgentState:
         """Increment and return the step counter for patch commits."""
         self.current_step += 1
         return self.current_step
+    
+    def increment_modifications(self) -> None:
+        """Increment modifications counter when files are changed."""
+        self.modifications_count += 1
+        self.file_cache.clear()  # Clear cache on modifications
     
     def check_timeout(self) -> bool:
         """Check if we've exceeded the timeout."""
